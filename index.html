<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Documentation dbt Project - Complet</title>
<style>
:root {
    --bg-color: #1e1e1e;
    --sidebar-color: #252526;
    --text-color: #cccccc;
    --accent-color: #007acc;
    --code-bg: #2d2d2d;
    --comment-color: #6a9955;
    --keyword-color: #569cd6;
}
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    display: flex;
    height: 100vh;
    overflow: hidden;
}
.sidebar {
    width: 300px;
    background-color: var(--sidebar-color);
    border-right: 1px solid #333;
    overflow-y: auto;
    padding: 10px;
    flex-shrink: 0;
}
.sidebar h2 { font-size:14px; text-transform:uppercase; padding-left:10px; color:#888; }
.tree-item { cursor:pointer; padding:4px 8px; border-radius:4px; display:block; text-decoration:none; color:var(--text-color); font-family:'Courier New',Courier,monospace; font-size:13px; white-space:nowrap;}
.tree-item:hover { background-color:#37373d; }
.folder { font-weight:bold; color:#dcb67a; margin-top:5px; }
.file { margin-left:15px; color:#9cdcfe; }
.main-content { flex-grow:1; padding:40px; overflow-y:auto; width:100%; }
.card { background-color: var(--sidebar-color); padding:20px; border-radius:8px; box-shadow:0 4px 15px rgba(0,0,0,0.3); display:none; }
.card.active { display:block; }
pre { background-color:var(--code-bg); padding:15px; border-radius:5px; overflow-x:auto; border-left:4px solid var(--accent-color); }
code { color:#ce9178; }
.comment { color: var(--comment-color); }
.keyword { color: var(--keyword-color); }
h1 { color:white; border-bottom:1px solid #444; padding-bottom:10px; }
.description { margin-bottom:20px; line-height:1.6; }
.command { color:#4ec9b0; font-family:monospace; background-color:#1b1b1b; padding:2px 5px; border-radius:4px; }
</style>
</head>
<body>
<div class="sidebar">
    <h2>ğŸ“ my_dbt_project</h2>
    <a href="#dbt_project" class="tree-item file">ğŸ“„ dbt_project.yml</a>
    <a href="#profiles" class="tree-item file">ğŸ“„ profiles.yml</a>
    
    <div class="tree-item folder">ğŸ“ models</div>
    <div style="margin-left:15px">
        <div class="tree-item folder">ğŸ“ stg</div>
        <a href="#stg_orders" class="tree-item file">ğŸ“„ stg_orders.sql</a>
        <a href="#stg_customers" class="tree-item file">ğŸ“„ stg_customers.sql</a>
        
        <div class="tree-item folder">ğŸ“ intermediate</div>
        <a href="#int_cleaning" class="tree-item file">ğŸ“„ intermediate_cleaning.sql</a>
        <a href="#int_agg" class="tree-item file">ğŸ“„ intermediate_agg.sql</a>
        
        <div class="tree-item folder">ğŸ“ marts</div>
        <a href="#final_report" class="tree-item file">ğŸ“„ final_report.sql</a>
        <a href="#revenue_summary" class="tree-item file">ğŸ“„ revenue_summary.sql</a>

        <div class="tree-item folder">ğŸ“ schema</div>
        <a href="#orders_columns" class="tree-item file">ğŸ“„ orders_columns.yml</a>
        <a href="#customers_columns" class="tree-item file">ğŸ“„ customers_columns.yml</a>
    </div>

    <div class="tree-item folder">ğŸ“ sources</div>
    <a href="#sources_sales" class="tree-item file" style="margin-left:15px">ğŸ“„ sales.yml</a>

    <div class="tree-item folder">ğŸ“ snapshots</div>
    <a href="#snapshot_orders" class="tree-item file" style="margin-left:15px">ğŸ“„ orders_snapshot.sql</a>

    <div class="tree-item folder">ğŸ“ seeds</div>
    <a href="#seed_countries" class="tree-item file" style="margin-left:15px">ğŸ“„ countries.csv</a>

    <div class="tree-item folder">ğŸ“ macros</div>
    <a href="#macro_multiply" class="tree-item file" style="margin-left:15px">ğŸ“„ my_macros.sql</a>

    <div class="tree-item folder">ğŸ“ analyses</div>
    <a href="#customer_analysis" class="tree-item file" style="margin-left:15px">ğŸ“„ customer_analysis.sql</a>
</div>

<div class="main-content" id="content-area">
    <div id="welcome" class="card active">
        <h1>Bienvenue dans ton Projet dbt</h1>
        <p class="description">Clique sur un fichier pour voir son contenu, son explication, son type et la commande dbt associÃ©e.</p>
    </div>

    <!-- dbt_project.yml -->
    <div id="dbt_project" class="card">
        <h1>dbt_project.yml</h1>
        <p class="description">Fichier de configuration principal du projet dbt. DÃ©finit chemins, matÃ©riel par dÃ©faut, variables et packages.</p>
        <pre><code><span class="keyword">name:</span> 'my_dbt_project'
<span class="keyword">config-version:</span> 2
<span class="keyword">models:</span>
  <span class="keyword">my_dbt_project:</span>
    <span class="keyword">stg:</span>
      <span class="keyword">+materialized:</span> view
    <span class="keyword">marts:</span>
      <span class="keyword">+materialized:</span> table
<span class="keyword">vars:</span>
  tax_rate: 0.15
  payment_methods: ['visa','paypal']</code></pre>
        <p>Commande : <span class="command">dbt run --select my_model</span></p>
    </div>

    <!-- profiles.yml -->
    <div id="profiles" class="card">
        <h1>profiles.yml</h1>
        <p class="description">Configuration de connexion au warehouse (Snowflake, BigQuery, Redshift...).</p>
        <pre><code>my_dbt_project:
  target: dev
  outputs:
    dev:
      type: snowflake
      account: xxxxx
      user: user
      password: ****
      role: ANALYST
      database: ANALYTICS
      warehouse: WH
      schema: dbt</code></pre>
    </div>

    <!-- stg_orders.sql -->
    <div id="stg_orders" class="card">
        <h1>stg_orders.sql</h1>
        <p class="description">ModÃ¨le <strong>staging</strong> : nettoie et prÃ©pare les commandes brutes pour les transformations.</p>
        <pre><code><span class="comment">-- RÃ©cupÃ©ration des commandes brutes</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> {{ source('sales','orders') }}</code></pre>
        <p>Commande : <span class="command">dbt run --select stg_orders</span></p>
    </div>

    <!-- stg_customers.sql -->
    <div id="stg_customers" class="card">
        <h1>stg_customers.sql</h1>
        <pre><code><span class="comment">-- Nettoyage des clients bruts</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> {{ source('sales','customers') }}</code></pre>
        <p>Commande : <span class="command">dbt run --select stg_customers</span></p>
    </div>

    <!-- intermediate_cleaning.sql -->
    <div id="int_cleaning" class="card">
        <h1>intermediate_cleaning.sql</h1>
        <p class="description">ModÃ¨le <strong>ephemeral</strong> : injectÃ© inline dans le modÃ¨le final. N'apparaÃ®t pas comme table ou vue.</p>
        <pre><code>{{ config(materialized=<span class="keyword">'ephemeral'</span>) }}
<span class="keyword">SELECT</span> *
<span class="keyword">FROM</span> {{ ref('stg_orders') }}
<span class="keyword">WHERE</span> amount &gt; 0</code></pre>
        <p>Commande : <span class="command">dbt run --select final_report</span></p>
    </div>

    <!-- intermediate_agg.sql -->
    <div id="int_agg" class="card">
        <h1>intermediate_agg.sql</h1>
        <p class="description">Table intermÃ©diaire, somme des commandes par client.</p>
        <pre><code>{{ config(materialized=<span class="keyword">'table'</span>) }}
<span class="keyword">SELECT</span> customer_id, SUM(amount) AS total
<span class="keyword">FROM</span> {{ ref('intermediate_cleaning') }}
<span class="keyword">GROUP BY</span> customer_id</code></pre>
        <p>Commande : <span class="command">dbt run --select intermediate_agg</span></p>
    </div>

    <!-- final_report.sql -->
    <div id="final_report" class="card">
        <h1>final_report.sql</h1>
        <p class="description">ModÃ¨le final. Reprend les donnÃ©es nettoyÃ©es des modÃ¨les intermÃ©diaires.</p>
        <pre><code><span class="keyword">SELECT</span> *
<span class="keyword">FROM</span> {{ ref('intermediate_cleaning') }}</code></pre>
        <p>Commande : <span class="command">dbt run --select final_report</span></p>
    </div>

    <!-- schema/orders_columns.yml -->
    <div id="orders_columns" class="card">
        <h1>orders_columns.yml</h1>
        <p class="description">Tests des colonnes pour stg_orders.</p>
        <pre><code>models:
  - name: stg_orders
    columns:
      - name: customer_id
        tests:
          - not_null
          - unique
      - name: amount
        tests:
          - not_null
          - severity: warn</code></pre>
        <p>Commande : <span class="command">dbt test --select stg_orders</span></p>
    </div>

    <!-- schema/customers_columns.yml -->
    <div id="customers_columns" class="card">
        <h1>customers_columns.yml</h1>
        <pre><code>models:
  - name: stg_customers
    columns:
      - name: customer_id
        tests:
          - not_null
          - unique</code></pre>
        <p>Commande : <span class="command">dbt test --select stg_customers</span></p>
    </div>

    <!-- sources/sales.yml -->
    <div id="sources_sales" class="card">
        <h1>sales.yml</h1>
        <p class="description">DÃ©finition des sources et contrÃ´le de fraÃ®cheur (freshness).</p>
        <pre><code>sources:
  - name: sales
    tables:
      - name: orders
        freshness:
          warn_after:
            count: 12
            period: hour
          error_after:
            count: 24
            period: hour
      - name: customers
        freshness:
          warn_after:
            count: 12
            period: hour
          error_after:
            count: 24
            period: hour</code></pre>
        <p>Commande : <span class="command">dbt source freshness</span></p>
    </div>

    <!-- snapshots/orders_snapshot.sql -->
    <div id="snapshot_orders" class="card">
        <h1>orders_snapshot.sql</h1>
        <p class="description">Historisation SCD Type 2 des commandes pour suivre lâ€™Ã©volution des donnÃ©es.</p>
        <pre><code>{% snapshot orders_snapshot %}
{{ config(
    target_schema='snapshots',
    unique_key='order_id',
    strategy='timestamp',
    updated_at='updated_at'
) }}
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> {{ ref('stg_orders') }}
{% endsnapshot %}</code></pre>
        <p>Commande : <span class="command">dbt snapshot --select orders_snapshot</span></p>
    </div>

    <!-- seeds/countries.csv -->
    <div id="seed_countries" class="card">
        <h1>countries.csv</h1>
        <p class="description">Table de rÃ©fÃ©rence statique importÃ©e depuis CSV.</p>
        <pre><code>id,country_name,country_code
1,France,FR
2,United States,US
3,Japan,JP</code></pre>
        <p>Commande : <span class="command">dbt seed --select countries</span></p>
    </div>

    <!-- macros/my_macros.sql -->
    <div id="macro_multiply" class="card">
        <h1>my_macros.sql</h1>
        <p class="description">Exemple de macro Jinja rÃ©utilisable.</p>
        <pre><code>{% macro multiply(a,b) %}
{{ a * b }}
{% endmacro %}</code></pre>
    </div>

    <!-- analyses/customer_analysis.sql -->
    <div id="customer_analysis" class="card">
        <h1>customer_analysis.sql</h1>
        <p class="description">Analyse ad hoc : compte le nombre de commandes par client.</p>
        <pre><code><span class="keyword">SELECT</span> customer_id, COUNT(*) AS nb_orders
<span class="keyword">FROM</span> {{ ref('stg_orders') }}
<span class="keyword">GROUP BY</span> customer_id</code></pre>
    </div>

    <!-- Section CI/CD / --state -->
    <div id="ci_cd" class="card">
        <h1>CI/CD & State-based selection</h1>
        <p class="description">Exemple : tu modifies le modÃ¨le B et veux rebuild seulement B et ses dÃ©pendances Câ†’D.</p>
        <pre><code># Commande dbt pour exÃ©cuter les modÃ¨les modifiÃ©s et leurs enfants
dbt run --state ./prod-state --select state:modified+</code></pre>
        <p>Explication : dbt utilise le dossier <span class="command">prod-state</span> pour comparer l'Ã©tat prÃ©cÃ©dent et exÃ©cute uniquement les modÃ¨les modifiÃ©s et leurs downstream.</p>
    </div>

</div>

<script>
// Affichage dynamique des cartes
document.querySelectorAll('.tree-item.file').forEach(item=>{
    item.addEventListener('click',function(e){
        const targetId=this.getAttribute('href').substring(1);
        document.querySelectorAll('.card').forEach(card=>card.classList.remove('active'));
        const targetCard=document.getElementById(targetId);
        if(targetCard) targetCard.classList.add('active');
    });
});
</script>
</body>
</html>
