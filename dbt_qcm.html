<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dbt Hard Mode - Mastering</title>
    <style>
        :root {
            --bg: #0d1117; 
            --card: #161b22; 
            --txt: #c9d1d9; 
            --border: #30363d;
            
            /* Les 3 Niveaux */
            --level-green: #2ea043;
            --level-orange: #f0883e;
            --level-red: #ff4500;
            
            /* Mise en lumi√®re Commandes */
            --cmd-main: #2ea043;  /* Vert pour dbt */
            --cmd-args: #58a6ff;  /* Bleu pour arguments */
            --hl-red: #ff7b72;    /* Rouge corail pour emphase */
            
            --green-ans: #238636;
        }
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: var(--bg); color: var(--txt); line-height: 1.4; margin: 0; padding: 10px;
        }
        .container { max-width: 700px; margin: 0 auto; }
        h1 { text-align: center; color: var(--level-red); font-size: 1.6rem; margin: 10px 0; }
        
        .intro { 
            background: var(--card); padding: 8px; border-radius: 6px; border: 1px solid var(--level-red);
            margin-bottom: 15px; font-size: 0.85rem; text-align: center;
        }

        .q-card { 
            background: var(--card); border: 1px solid var(--border); border-radius: 12px; 
            padding: 15px; margin-bottom: 15px; 
        }

        /* --- STYLES DES TITRES (LES 3 NIVEAUX) --- */
        .q-head { color: var(--level-red); font-weight: bold; font-size: 0.85rem; display: block; text-transform: uppercase; }
        .q-head_orange { color: var(--level-orange); font-weight: bold; font-size: 0.85rem; display: block; text-transform: uppercase; }
        .q-head_green { color: var(--level-green); font-weight: bold; font-size: 0.85rem; display: block; text-transform: uppercase; }

        .q-txt { font-weight: 600; margin: 8px 0 12px 0; display: block; font-size: 1rem; }
        .opt { background: #21262d; padding: 10px 12px; margin: 6px 0; border-radius: 6px; font-size: 0.9rem; }
        
        /* SYNTAX HIGHLIGHTING DANS CODE */
        code { 
            background: #000; padding: 2px 5px; border-radius: 4px; 
            font-family: 'Courier New', monospace; font-size: 0.85rem; color: var(--txt);
        }
        .cmd { color: var(--cmd-main); font-weight: bold; }
        .arg { color: var(--cmd-args); }
        .hl { color: var(--hl-red); font-weight: bold; }

        .ans { 
            display: none; margin-top: 12px; padding: 12px; font-size: 0.85rem;
            background: rgba(35, 134, 54, 0.05); border-left: 4px solid var(--green-ans); border-radius: 4px;
        }
        .trap { color: #8b949e; font-style: italic; display: block; margin-top: 8px; }

        /* --- BOUTONS ADAPTATIFS --- */
        .btn { 
            background: none; border-radius: 20px; cursor: pointer; font-size: 0.8rem; 
            margin-top: 10px; font-weight: bold; transition: 0.2s; padding: 5px 15px;
        }
        .q-head ~ .btn { border: 1px solid var(--level-red); color: var(--level-red); }
        .q-head ~ .btn:hover { background: var(--level-red); color: #fff; }
        .q-head_orange ~ .btn { border: 1px solid var(--level-orange); color: var(--level-orange); }
        .q-head_orange ~ .btn:hover { background: var(--level-orange); color: #fff; }
        .q-head_green ~ .btn { border: 1px solid var(--level-green); color: var(--level-green); }
        .q-head_green ~ .btn:hover { background: var(--level-green); color: #fff; }

        .footer { text-align: center; font-size: 0.8rem; padding: 20px; border-top: 1px solid var(--border); margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üß† dbt ‚Äî HARD MODE üî•</h1>
    <div class="intro">Plusieurs r√©ponses possibles. Focus sur les pi√®ges r√©els de production.</div>

<div class="q-card">
    <span class="q-head_orange">QCM 1Ô∏è‚É£ ‚Äî SOURCE vs MODEL</span>
    <span class="q-txt">Quelles commandes s‚Äôex√©cutent SUR UNE SOURCE ?</span>

    <div class="opt">A. <code><span class="cmd">dbt</span> <span class="arg">test --select source:raw.customers</span></code></div>
    <div class="opt">B. <code><span class="cmd">dbt</span> <span class="arg">run --select source:raw.customers</span></code></div>
    <div class="opt">C. <code><span class="cmd">dbt</span> <span class="arg">source freshness --select source:raw.customers</span></code></div>
    <div class="opt">D. <code><span class="cmd">dbt</span> <span class="arg">build --select source:raw.customers</span></code></div>

    <button class="btn" onclick="t(this)">V√©rifier</button>

    <div class="ans">
        <strong>‚úÖ R√©ponses : A, C, D</strong>

        <span class="trap">
            üß† <b>Pi√®ges et explications d√©taill√©es :</b>
            <ul>
                <li><b>A ‚Äî dbt test</b> : ‚úÖ Valide une source, permet de v√©rifier les contraintes (<code>not_null</code>, <code>unique</code>) directement sur les tables externes. <b>Note examen :</b> Toujours ajouter <code>source:</code> pour tester une source, sinon dbt cherche un mod√®le et √©choue.</li>
                <li><b>B ‚Äî dbt run</b> : ‚ùå Ne s‚Äôapplique pas aux sources. <b>Erreur fr√©quente :</b> Run cr√©e des objets (tables/vues) seulement pour les mod√®les dbt. Les sources sont externes, dbt ne peut rien ex√©cuter dessus.</li>
                <li><b>C ‚Äî dbt source freshness</b> : ‚úÖ Mesure la fra√Æcheur des donn√©es d‚Äôune source (SLA), permet de savoir si la table a √©t√© mise √† jour r√©cemment. <b>Astuce :</b> Utiliser apr√®s ingestion, mais ce n‚Äôest pas un test de contenu.</li>
                <li><b>D ‚Äî dbt build</b> : ‚úÖ Inclut tout le pipeline dbt : run + test + snapshot + seed. Comme il inclut les tests, il peut √™tre consid√©r√© comme ‚Äúvalide‚Äù pour les sources si des tests sont d√©finis. <b>Attention :</b> Build est holistique, donc en dev utiliser <code>--select</code> pour cibler pr√©cis√©ment la source ou le mod√®le.</li>
            </ul>
            üí° <b>R√©sum√© rapide :</b> Les sources n‚Äôont jamais de SQL ex√©cut√© directement ; <b>run</b> = mod√®les seulement, <b>test</b> et <b>source freshness</b> = v√©rification, <b>build</b> = tout inclus.
        </span>
    </div>
</div>



    <div class="q-card">
        <span class="q-head">QCM 2Ô∏è‚É£ ‚Äî STATE SELECTION</span>
        <span class="q-txt">Effet exact de : <code><span class="cmd">dbt</span> <span class="arg">build --select state:modified+</span></code> ?</span>
        <div class="opt">A. Ex√©cute uniquement les mod√®les modifi√©s</div>
        <div class="opt">B. Ex√©cute les mod√®les modifi√©s + leurs enfants</div>
        <div class="opt">C. Ex√©cute les mod√®les modifi√©s + leurs parents</div>
        <div class="opt">D. Inclut les tests li√©s aux mod√®les s√©lectionn√©s</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponses : B, D</strong>
            <span class="trap">üß† Pi√®ge : Le <b class="hl">+</b> apr√®s = <b class="arg">downstream</b>. Le <b class="cmd">build</b> couple l'ex√©cution et le test, garantissant que les enfants ne tournent que si les parents modifi√©s sont valides.</span>
        </div>
    </div>

    

    <div class="q-card">
        <span class="q-head">QCM 3Ô∏è‚É£ ‚Äî INCREMENTAL</span>
        <span class="q-txt">Quand le <code><span class="arg">--full-refresh</span></code> est-il r√©ellement n√©cessaire ?</span>
        <div class="opt">A. Changement de logique SQL (calcul, etc.)</div>
        <div class="opt">B. Changement de la cl√© unique (<code><span class="hl">unique_key</span></code>)</div>
        <div class="opt">C. Changement de filtre WHERE</div>
        <div class="opt">D. Donn√©es corrompues ou d√©calage historique</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponses : B, D</strong>
            <span class="trap">üß† Pi√®ge : Changer la <b class="hl">unique_key</b> sans full-refresh cr√©e des doublons car dbt ne sait plus quelles lignes "√©craser" dans la table existante.</span>
        </div>
    </div>

    <div class="q-card">
        <span class="q-head_orange">QCM 4Ô∏è‚É£ ‚Äî + vs @ (DAG)</span>
        <span class="q-txt">Diff√©rence entre <code><span class="arg">+model</span></code> et <code><span class="arg">@model</span></code> ?</span>
        <div class="opt">A. +model inclut les parents (upstream)</div>
        <div class="opt">B. @model inclut les parents</div>
        <div class="opt">C. @model inclut le mod√®le + parents + enfants</div>
        <div class="opt">D. @model respecte l‚Äô√©tat pr√©c√©dent</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponses : A, C, D</strong>
            <span class="trap">üß† Pi√®ge expert : <b class="hl">@</b> s√©lectionne le mod√®le, ses parents, et TOUT le lignage descendant de ces parents. C'est le s√©lecteur le plus large pour la s√©curit√©.</span>
        </div>
    </div>

    <div class="q-card">
        <span class="q-head">QCM 5Ô∏è‚É£ ‚Äî TESTS SILENCIEUX</span>
        <span class="q-txt">Pourquoi un build peut "r√©ussir" avec des donn√©es mauvaises ?</span>
        <div class="opt">A. Tests absents</div>
        <div class="opt">B. Tests configur√©s en 'warn'</div>
        <div class="opt">C. Absence de flag <code><span class="arg">--warn-error</span></code></div>
        <div class="opt">D. Tests d√©sactiv√©s par tags</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponses : A, B, C, D</strong>
            <span class="trap">üß† Pi√®ge : Par d√©faut, un test qui √©choue en 'warning' ne bloque pas le build. Sans <b class="hl">--warn-error</b>, la CI passera au vert malgr√© l'alerte.</span>
        </div>
    </div>

    <div class="q-card">
        <span class="q-head_green">QCM 6Ô∏è‚É£ ‚Äî FRESHNESS</span>
        <span class="q-txt">Que mesure r√©ellement <code><span class="cmd">source freshness</span></code> ?</span>
        <div class="opt">A. La qualit√© intrins√®que des donn√©es</div>
        <div class="opt">B. Le d√©lai depuis la derni√®re ingestion</div>
        <div class="opt">C. Le respect des SLAs de mise √† jour</div>
        <div class="opt">D. La pr√©sence de valeurs nulles</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponses : B, C</strong>
            <span class="trap">üß† Pi√®ge : La freshness ne regarde pas le contenu (nulls, types), mais uniquement le timestamp de la colonne charg√©e pour voir si l'ingestion est "fra√Æche".</span>
        </div>
    </div>

    <div class="q-card">
        <span class="q-head_green">QCM 7Ô∏è‚É£ ‚Äî DBT LS</span>
        <span class="q-txt">Quels filtres sont valides avec <code><span class="cmd">dbt</span> <span class="arg">ls</span></code> ?</span>
        <div class="opt">A. <code><span class="arg">tag:nom_tag</span></code></div>
        <div class="opt">B. <code><span class="arg">path:models/marts</span></code></div>
        <div class="opt">C. <code><span class="arg">source:nom_source</span></code></div>
        <div class="opt">D. <code><span class="arg">state:modified</span></code></div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponses : A, B, C, D</strong>
            <span class="trap">üß† Pi√®ge : <b class="cmd">ls</b> accepte quasiment tous les s√©lecteurs de dbt run. C'est l'outil parfait pour tester ses s√©lecteurs avant de lancer un gros build en prod.</span>
        </div>
    </div>

    <div class="q-card">
        <span class="q-head">QCM 8Ô∏è‚É£ ‚Äî SNAPSHOTS</span>
        <span class="q-txt">Quelles actions peuvent CASSER un snapshot existant ?</span>
        <div class="opt">A. Modifier la <code><span class="hl">unique_key</span></code></div>
        <div class="opt">B. Modifier la <code><span class="hl">strategy</span></code> (check vs timestamp)</div>
        <div class="opt">C. Modifier une colonne non suivie</div>
        <div class="opt">D. Faire un <code><span class="arg">--full-refresh</span></code> sur le snapshot</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponses : A, B, D</strong>
            <span class="trap">üß† R√®gle : Un snapshot est un contrat historique. Changer la cl√© ou la strat√©gie corrompt le lignage des versions (SCD Type 2).</span>
        </div>
    </div>

    <div class="q-card">
        <span class="q-head_orange">QCM 9Ô∏è‚É£ ‚Äî COMPILE VS RUN</span>
        <span class="q-txt">Cas n√©cessitant <code><span class="cmd">dbt</span> <span class="arg">compile</span></code> plut√¥t que <code><span class="arg">run</span></code> ?</span>
        <div class="opt">A. Debugger une macro complexe</div>
        <div class="opt">B. Revue de code (PR) sans acc√®s write au warehouse</div>
        <div class="opt">C. Audit de s√©curit√© du SQL g√©n√©r√©</div>
        <div class="opt">D. Cr√©ation d'une table temporaire</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
		
	
		
		
		
		<div class="ans">
    <strong>‚úÖ R√©ponses : A, B, C</strong>
    <span class="trap">
        üß† <strong>Conseil d'expert :</strong> 
        <code>dbt compile</code> effectue la <em>transformation de template Jinja ‚Üí SQL natif</em> 
        et stocke le r√©sultat dans le dossier <b class="arg">target/</b>. 
        <br><br>
        
        üìÅ <strong>Ce que vous y trouverez :</strong>
        <ul style="margin: 5px 0 0 20px; padding-left: 10px;">
            <li><code>target/compiled/</code> : Le SQL final g√©n√©r√© pour chaque mod√®le</li>
            <li><code>target/run/</code> : Les manifestes et graphes de d√©pendance</li>
            <li><code>target/graph_summary.json</code> : Vue d'ensemble du projet</li>
        </ul>
        
        üîç <strong>Cas d'usage critique :</strong>
        C'est indispensable pour <em>auditer, d√©boguer ou valider</em> le code SQL que dbt 
        enverrait √† l'entrep√¥t, <u>sans ex√©cuter la moindre requ√™te</u>. 
        
        <br><br>
        ‚ö° <strong>Workflow pratique :</strong>
        <code>dbt compile ‚Üí inspect target/compiled/votre_mod√®le.sql ‚Üí valider/ajuster</code>
    </span>
</div>



    </div>

    <div class="q-card">
        <span class="q-head">QCM üîü ‚Äî STRAT√âGIE PROD SAFE</span>
        <span class="q-txt">Corriger un bug critique avec impact minimal ?</span>
        <div class="opt">A. <code><span class="cmd">dbt</span> <span class="arg">run</span></code> (complet)</div>
        <div class="opt">B. <code><span class="cmd">dbt</span> <span class="arg">build --select state:modified+ --fail-fast --warn-error</span></code></div>
        <div class="opt">C. <code><span class="cmd">dbt</span> <span class="arg">run --full-refresh</span></code></div>
        <div class="opt">D. <code><span class="cmd">dbt</span> <span class="arg">build</span></code> (complet)</div>
        <button class="btn" onclick="t(this)">V√©rifier</button>
        <div class="ans">
            <strong>‚úÖ R√©ponse : B</strong>
            <span class="trap">üß† Pi√®ge ultime : En prod, on utilise <b class="arg">state:modified+</b> pour isoler le changement et <b class="hl">fail-fast</b> pour s'arr√™ter au moindre p√©pin.</span>
        </div>
    </div>

    <div class="footer">
        <strong>V√©rification r√©seau :</strong> Freebox-49010A active ‚úÖ<br>
        <em>Expert Mode ‚Äî dbt Core & Cloud certified</em>
    </div>
</div>

<script>
    function t(b) {
        var a = b.nextElementSibling;
        a.style.display = (a.style.display === 'block') ? 'none' : 'block';
        b.innerText = (a.style.display === 'block') ? 'Masquer' : 'V√©rifier';
    }
</script>

</body>
</html>